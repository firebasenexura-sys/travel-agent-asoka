(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,54338,e=>{"use strict";var a=e.i(43476),s=e.i(71645),t=e.i(22016),l=e.i(18566),i=e.i(33842);e.i(51718);var r=e.i(18357);e.i(36180);var o=e.i(98925);e.i(61086);var n=e.i(27215);function d({message:e,type:t,onDone:l}){return(0,s.useEffect)(()=>{let e=setTimeout(l,3e3);return()=>clearTimeout(e)},[l]),(0,a.jsx)("div",{className:`fixed top-5 left-1/2 -translate-x-1/2 p-4 rounded-lg shadow-lg text-white ${"success"===t?"bg-green-600":"bg-red-600"} z-50`,children:e})}function c({text:e="Memuat..."}){return(0,a.jsx)("div",{className:"fixed inset-0 bg-white/80 z-[60] flex items-center justify-center",children:(0,a.jsxs)("div",{className:"flex flex-col items-center",children:[(0,a.jsx)("div",{className:"w-12 h-12 border-4 border-gray-200 border-t-blue-600 rounded-full animate-spin"}),(0,a.jsx)("p",{className:"mt-2 text-gray-700 font-semibold",children:e})]})})}function m(){let e=(0,l.useRouter)(),[m,u]=(0,s.useState)(null),[g,b]=(0,s.useState)(!0),[f,x]=(0,s.useState)(!1),[p,h]=(0,s.useState)(null),[y,j]=(0,s.useState)([]),[v,w]=(0,s.useState)(!1),[N,k]=(0,s.useState)(null),[D,S]=(0,s.useState)(""),[U,C]=(0,s.useState)(""),[G,T]=(0,s.useState)(null),[B,F]=(0,s.useState)(null),[$,E]=(0,s.useState)(null),M=(0,o.collection)(i.db,"destinations");(0,s.useEffect)(()=>{let a=(0,r.onAuthStateChanged)(i.auth,a=>{a?u(a.uid):e.push("/admin")}),s=()=>{};if(m){0===y.length&&b(!0);let e=(0,o.query)(M,(0,o.orderBy)("name","asc"));s=(0,o.onSnapshot)(e,e=>{j(e.docs.map(e=>({id:e.id,...e.data()}))),b(!1)},e=>{console.error("Gagal mengambil data destinasi:",e),h({msg:"Gagal memuat data destinasi.",type:"error"}),b(!1)})}else b(!1);return()=>{a(),s()}},[e,m]);let z=()=>{k(null),S(""),C(""),T(null),F(null),E(null)},R=()=>{f||(z(),w(!1))},A=async e=>{if(e.preventDefault(),!m||!D)return void h({msg:"Nama destinasi wajib diisi.",type:"error"});if(!N&&!G)return void h({msg:"Foto destinasi wajib diupload.",type:"error"});x(!0),h(null);try{let e=$||"";if(G){if($)try{let e=(0,n.ref)(i.storage,$);await (0,n.deleteObject)(e),console.log("Gambar lama destinasi dihapus")}catch(e){"storage/object-not-found"!==e.code&&console.warn("Gagal hapus gambar lama, tapi lanjut:",e)}let a=`${m}_dest_${Date.now()}_${G.name}`,s=(0,n.ref)(i.storage,`destinations/${a}`);console.log(`Uploading ke: destinations/${a}`);let t=await (0,n.uploadBytes)(s,G);e=await (0,n.getDownloadURL)(t.ref),console.log("Upload gambar destinasi berhasil:",e)}else if(!N&&!e)throw Error("Gambar destinasi wajib ada untuk item baru.");let a={name:D,description:U,imageUrl:e,updatedAt:(0,o.serverTimestamp)()};if(N){let e=(0,o.doc)(i.db,"destinations",N);await (0,o.updateDoc)(e,a),console.log("Destinasi diupdate:",N)}else{let e=await (0,o.addDoc)(M,{...a,createdAt:(0,o.serverTimestamp)()});console.log("Destinasi baru ditambahkan:",e.id)}h({msg:"Destinasi berhasil disimpan!",type:"success"}),R()}catch(e){console.error("Gagal menyimpan destinasi:",e),h({msg:`Gagal menyimpan: ${e.message||e.code}`,type:"error"})}finally{x(!1)}},O=async e=>{if(confirm(`Yakin ingin menghapus destinasi "${e.name}"?`)){x(!0),h(null);try{if(await (0,o.deleteDoc)((0,o.doc)(i.db,"destinations",e.id)),console.log("Dokumen Firestore dihapus:",e.id),e.imageUrl)try{let a=(0,n.ref)(i.storage,e.imageUrl);await (0,n.deleteObject)(a),console.log("Gambar Storage dihapus:",e.imageUrl)}catch(a){"storage/object-not-found"!==a.code?console.warn("Gagal hapus gambar, tapi dokumen terhapus:",a):console.log("Gambar sudah tidak ada di storage:",e.imageUrl)}h({msg:"Destinasi berhasil dihapus.",type:"success"})}catch(e){console.error("Gagal menghapus destinasi:",e),h({msg:`Gagal menghapus: ${e.message||e.code}`,type:"error"})}finally{x(!1)}}};return(0,a.jsxs)(a.Fragment,{children:[p&&(0,a.jsx)(d,{message:p.msg,type:p.type,onDone:()=>h(null)}),g&&(0,a.jsx)(c,{text:"Memuat destinasi..."}),f&&(0,a.jsx)(c,{text:"Menyimpan/Menghapus..."}),(0,a.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,a.jsxs)("div",{className:"flex items-center gap-4",children:[(0,a.jsx)(t.default,{href:"/dashboard/cms",children:(0,a.jsxs)("span",{className:"text-gray-500 hover:text-blue-600 cursor-pointer",children:[(0,a.jsx)("i",{className:"fas fa-arrow-left mr-2"}),"Kembali ke Hpanel"]})}),(0,a.jsx)("h2",{className:"text-2xl font-bold text-gray-800",children:"Destinasi Unggulan"})]}),(0,a.jsxs)("button",{onClick:()=>{z(),w(!0)},className:"bg-blue-600 text-white font-semibold py-2 px-4 rounded-lg shadow-md hover:bg-blue-700 transition-all flex items-center gap-2",children:[(0,a.jsx)("i",{className:"fas fa-plus"})," Tambah Destinasi"]})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6",children:[y.map(e=>(0,a.jsxs)("div",{className:"bg-white rounded-xl shadow-lg border border-gray-200 flex flex-col overflow-hidden transition-all hover:shadow-xl relative group",children:[(0,a.jsxs)("div",{className:"aspect-video bg-gray-200",children:[" ",(0,a.jsx)("img",{src:e.imageUrl||"https://placehold.co/400x225/e2e8f0/94a3b8?text=No+Image",alt:e.name,className:"w-full h-full object-cover"})]}),(0,a.jsxs)("div",{className:"p-4 flex flex-col flex-grow",children:[(0,a.jsx)("h3",{className:"text-lg font-bold text-gray-900 mb-1 truncate",children:e.name}),(0,a.jsx)("p",{className:"text-sm text-gray-600 line-clamp-2 flex-grow",children:e.description||"Tidak ada deskripsi."}),(0,a.jsxs)("div",{className:"mt-4 pt-3 border-t border-gray-100 flex gap-3 opacity-0 group-hover:opacity-100 focus-within:opacity-100 transition-opacity duration-300",children:[(0,a.jsxs)("button",{onClick:()=>{z(),k(e.id),S(e.name),C(e.description),F(e.imageUrl),E(e.imageUrl),w(!0)},className:"w-full bg-blue-100 text-blue-700 font-semibold py-2 px-3 rounded-lg hover:bg-blue-200 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-1",children:[(0,a.jsx)("i",{className:"fas fa-edit mr-1"})," Edit"]}),(0,a.jsxs)("button",{onClick:()=>O(e),className:"w-full bg-red-100 text-red-700 font-semibold py-2 px-3 rounded-lg hover:bg-red-200 text-sm focus:outline-none focus:ring-2 focus:ring-red-500 focus:ring-offset-1",children:[(0,a.jsx)("i",{className:"fas fa-trash mr-1"})," Hapus"]})]})]})]},e.id)),!g&&0===y.length&&(0,a.jsx)("p",{className:"text-center text-gray-500 py-10 col-span-full",children:'Belum ada destinasi unggulan. Klik "Tambah Destinasi" untuk memulai.'})]}),v&&(0,a.jsxs)("div",{className:"fixed inset-0 bg-black/50 z-40 flex items-center justify-center p-4",children:[(0,a.jsx)("div",{onClick:R,className:"absolute inset-0"}),(0,a.jsxs)("div",{className:"relative bg-white rounded-2xl shadow-2xl w-full max-w-lg max-h-[90vh] flex flex-col",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between p-5 border-b border-gray-200 sticky top-0 bg-white rounded-t-2xl z-10",children:[(0,a.jsx)("h2",{className:"text-xl font-bold text-gray-900",children:N?"Edit Destinasi":"Tambah Destinasi Baru"}),(0,a.jsx)("button",{onClick:R,className:"text-gray-400 hover:text-gray-600",children:(0,a.jsx)("i",{className:"fas fa-times fa-lg"})})]}),(0,a.jsxs)("form",{id:"destinationForm",onSubmit:A,className:"flex-grow overflow-y-auto p-6 space-y-5",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{htmlFor:"destName",className:"block text-sm font-medium text-gray-700 mb-1",children:"Nama Destinasi"}),(0,a.jsx)("input",{id:"destName",type:"text",value:D,onChange:e=>S(e.target.value),required:!0,className:"w-full p-3 border border-gray-300 rounded-lg shadow-sm focus:border-blue-500 focus:ring-blue-500"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{htmlFor:"destDescription",className:"block text-sm font-medium text-gray-700 mb-1",children:"Deskripsi Singkat"}),(0,a.jsx)("textarea",{id:"destDescription",value:U,onChange:e=>C(e.target.value),rows:4,className:"w-full p-3 border border-gray-300 rounded-lg shadow-sm focus:border-blue-500 focus:ring-blue-500",placeholder:"Jelaskan daya tarik utama destinasi ini..."})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Foto Utama (Maks 2MB)"}),B?(0,a.jsx)("img",{src:B,alt:"Preview",className:"w-full aspect-video object-cover border border-gray-200 rounded-lg bg-gray-50 mb-2"}):(0,a.jsx)("div",{className:"w-full aspect-video flex items-center justify-center border border-dashed border-gray-300 rounded-lg bg-gray-50 text-gray-400 mb-2",children:"Image Preview"}),(0,a.jsx)("input",{id:"destImageFile",type:"file",accept:"image/png, image/jpeg, image/webp",onChange:e=>{let a=e.target.files?.[0];if(a){if(a.size>2097152)return void h({msg:"Ukuran foto maksimal 2 MB.",type:"error"});T(a),F(URL.createObjectURL(a))}},className:"block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100"})]})]}),(0,a.jsxs)("div",{className:"flex items-center justify-end p-5 border-t border-gray-200 sticky bottom-0 bg-gray-50 rounded-b-2xl z-10",children:[(0,a.jsx)("button",{onClick:R,type:"button",className:"bg-white text-gray-700 font-semibold py-2 px-4 rounded-lg border border-gray-300 mr-3 hover:bg-gray-50",children:"Batal"}),(0,a.jsxs)("button",{type:"submit",form:"destinationForm",disabled:f,className:"bg-blue-600 text-white font-semibold py-2 px-4 rounded-lg shadow-md hover:bg-blue-700 transition-all disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2",children:[f?(0,a.jsx)("i",{className:"fas fa-spinner fa-spin"}):(0,a.jsx)("i",{className:"fas fa-save"}),N?"Update Destinasi":"Simpan Destinasi"]})]})]})]})]})}e.s(["default",()=>m])}]);