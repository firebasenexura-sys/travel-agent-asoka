(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,71934,e=>{"use strict";var a=e.i(43476),l=e.i(71645),t=e.i(22016),s=e.i(18566),r=e.i(33842);e.i(51718);var o=e.i(18357);e.i(36180);var i=e.i(98925);e.i(61086);var n=e.i(27215);function c({message:e,type:t,onDone:s}){return(0,l.useEffect)(()=>{let e=setTimeout(s,3e3);return()=>clearTimeout(e)},[s]),(0,a.jsx)("div",{className:`fixed top-5 left-1/2 -translate-x-1/2 p-4 rounded-lg shadow-lg text-white ${"success"===t?"bg-green-600":"bg-red-600"} z-50`,children:e})}function d({text:e="Memuat..."}){return(0,a.jsx)("div",{className:"fixed inset-0 bg-white/80 z-[60] flex items-center justify-center",children:(0,a.jsxs)("div",{className:"flex flex-col items-center",children:[(0,a.jsx)("div",{className:"w-12 h-12 border-4 border-gray-200 border-t-blue-600 rounded-full animate-spin"}),(0,a.jsx)("p",{className:"mt-2 text-gray-700 font-semibold",children:e})]})})}function m(){let e=(0,s.useRouter)(),[m,g]=(0,l.useState)(null),[u,p]=(0,l.useState)(!0),[h,b]=(0,l.useState)(!1),[f,x]=(0,l.useState)(null),[y,j]=(0,l.useState)([]),[v,w]=(0,l.useState)([]),[k,N]=(0,l.useState)([]),U=(0,i.doc)(r.db,"gallery","main");(0,l.useEffect)(()=>{let a=(0,o.onAuthStateChanged)(r.auth,a=>{a?g(a.uid):e.push("/admin")}),l=()=>{};return m?(0===v.length&&0===k.length&&p(!0),l=(0,i.onSnapshot)(U,e=>{let a=[];N(a=e.exists()&&e.data().imageUrls||[]),w(e=>{let l=e.filter(e=>e.startsWith("blob:")),t=y.filter(e=>l.includes(e.previewUrl)).map(e=>e.previewUrl),s=Array.from(new Set([...a,...t]));return console.log("onSnapshot Update Previews:",s),s.slice(0,100)}),p(!1)},e=>{console.error("Gagal mengambil data galeri:",e),x({msg:"Gagal memuat data galeri.",type:"error"}),p(!1)})):p(!1),()=>{a(),l(),y.forEach(e=>URL.revokeObjectURL(e.previewUrl))}},[e,m]);let S=(0,l.useCallback)(e=>{let a=v[e];if(w(v.filter((a,l)=>l!==e)),a.startsWith("blob:")){j(y.filter(e=>e.previewUrl!==a));try{URL.revokeObjectURL(a),console.log("Blob URL revoked:",a)}catch(e){console.warn("Could not revoke blob URL:",a,e)}}},[v,y]),$=async()=>{if(console.log("Memulai handleSaveGallery..."),!m)return void x({msg:"Error: User tidak terautentikasi.",type:"error"});b(!0),x(null);try{let e=v.filter(e=>e.startsWith("https://"));console.log("URL lama yang masih ada:",e);let a=y.map(e=>e.file);console.log(`Jumlah file baru untuk diupload: ${a.length}`,a.map(e=>e.name));let l=[];if(a.length>0){x({msg:`Mengupload ${a.length} foto baru...`,type:"success"}),console.log("Memulai upload...");let e=a.map(async(e,a)=>{let l=`${m}_gallery_${Date.now()}_${a}_${e.name}`,t=(0,n.ref)(r.storage,`gallery/${l}`);console.log(`Uploading ${e.name} ke path: gallery/${l}`);try{let a=await (0,n.uploadBytes)(t,e),l=await (0,n.getDownloadURL)(a.ref);return console.log(`Upload ${e.name} BERHASIL, URL:`,l),l}catch(a){throw console.error(`Upload ${e.name} GAGAL:`,a),Error(`Gagal upload ${e.name}: ${a.message||a.code}`)}});l=await Promise.all(e),console.log("Semua upload baru selesai. URL baru:",l)}else console.log("Tidak ada file baru untuk diupload.");let t=[...e,...l];console.log("URL final yang akan disimpan:",t);let s=k.filter(e=>!t.includes(e));if(s.length>0){console.log("Akan menghapus gambar lama dari Storage:",s);let e=s.map(async e=>{try{let a=(0,n.ref)(r.storage,e);await (0,n.deleteObject)(a),console.log("Gambar lama dihapus:",e)}catch(a){"storage/object-not-found"!==a.code?console.warn("Gagal hapus gambar lama:",e,a):console.log("Gambar lama sudah tidak ada di storage:",e)}});await Promise.all(e)}else console.log("Tidak ada gambar lama yang perlu dihapus dari Storage.");console.log("Menyimpan ke Firestore..."),await (0,i.setDoc)(U,{imageUrls:t,updatedAt:(0,i.serverTimestamp)()},{merge:!0}),console.log("Berhasil menyimpan ke Firestore."),N(t),j([]),w(t),x({msg:"Galeri berhasil disimpan!",type:"success"})}catch(e){console.error("GAGAL TOTAL menyimpan galeri:",e),x({msg:e.message.startsWith("Gagal upload")?e.message:"Gagal menyimpan galeri. Cek console.",type:"error"})}finally{b(!1),console.log("handleSaveGallery Selesai.")}};return(0,a.jsxs)(a.Fragment,{children:[f&&(0,a.jsx)(c,{message:f.msg,type:f.type,onDone:()=>x(null)}),u&&(0,a.jsx)(d,{text:"Memuat galeri..."}),h&&(0,a.jsx)(d,{text:"Menyimpan galeri..."}),(0,a.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,a.jsxs)("div",{className:"flex items-center gap-4",children:[(0,a.jsx)(t.default,{href:"/dashboard/cms",children:(0,a.jsxs)("span",{className:"text-gray-500 hover:text-blue-600 cursor-pointer",children:[(0,a.jsx)("i",{className:"fas fa-arrow-left mr-2"}),"Kembali ke Hpanel"]})}),(0,a.jsx)("h2",{className:"text-2xl font-bold text-gray-800",children:"Edit Galeri Foto"})]}),(0,a.jsxs)("button",{onClick:$,disabled:h||u,className:"bg-blue-600 text-white font-semibold py-2 px-5 rounded-lg shadow-md hover:bg-blue-700 transition-all disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2",children:[h?(0,a.jsx)("i",{className:"fas fa-spinner fa-spin"}):(0,a.jsx)("i",{className:"fas fa-save"}),"Simpan Galeri"]})]}),(0,a.jsxs)("div",{className:"bg-white p-6 rounded-xl shadow-lg border border-gray-200",children:[(0,a.jsxs)("h3",{className:"text-xl font-semibold text-gray-800 border-b border-gray-200 pb-3 mb-4",children:[(0,a.jsx)("i",{className:"fas fa-images mr-2 text-pink-500"})," Kelola Foto Galeri (Maks 100)"]}),(0,a.jsxs)("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-4 mb-6",children:[v.map((e,l)=>(0,a.jsxs)("div",{className:"relative group aspect-square",children:[" ",(0,a.jsx)("img",{src:e,alt:`Preview ${l+1}`,className:"w-full h-full object-cover rounded-lg border border-gray-200"}),(0,a.jsx)("button",{type:"button",onClick:()=>S(l),className:"absolute -top-1 -right-1 bg-red-600 text-white rounded-full w-6 h-6 flex items-center justify-center text-sm opacity-0 group-hover:opacity-100 transition-opacity focus:opacity-100 shadow","aria-label":"Hapus gambar",children:(0,a.jsx)("i",{className:"fas fa-times"})})]},`${e}-${l}`)),v.length<100&&(0,a.jsxs)("label",{htmlFor:"galleryImages",className:"cursor-pointer aspect-square flex flex-col items-center justify-center border-2 border-dashed border-gray-300 rounded-lg text-gray-400 hover:border-blue-500 hover:text-blue-500 transition-colors",children:[(0,a.jsx)("i",{className:"fas fa-plus fa-2x mb-1"}),(0,a.jsx)("span",{className:"text-xs font-medium",children:"Tambah Foto"})]})]}),(0,a.jsx)("input",{id:"galleryImages",type:"file",accept:"image/jpeg,image/png,image/webp",multiple:!0,onChange:e=>{let a=e.target.files;if(a){let l=Array.from(a),t=100-v.length,s=l.slice(0,t);l.length>t&&x({msg:`Hanya bisa menambah ${t} foto lagi (total maks 100).`,type:"error"});let r=[],o=[];for(let e of s){if(e.size>2097152){x({msg:`File "${e.name}" terlalu besar (maks 2 MB).`,type:"error"});continue}let a=URL.createObjectURL(e);r.push({file:e,previewUrl:a}),o.push(a)}j(e=>[...e,...r]),w(e=>[...e,...o]),e.target.value=""}},disabled:v.length>=100||h,className:"hidden"}),v.length>=100&&(0,a.jsx)("p",{className:"text-sm text-center text-red-600 mb-4",children:"Batas maksimal 100 foto tercapai."})]})]})}e.s(["default",()=>m])}]);