(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,72907,e=>{"use strict";var t=e.i(43476),a=e.i(71645),s=e.i(22016),l=e.i(18566),r=e.i(33842);e.i(51718);var i=e.i(18357);e.i(36180);var o=e.i(98925);e.i(61086);var d=e.i(27215);function n({message:e,type:s,onDone:l}){return(0,a.useEffect)(()=>{let e=setTimeout(l,3e3);return()=>clearTimeout(e)},[l]),(0,t.jsx)("div",{className:`fixed top-5 left-1/2 -translate-x-1/2 p-4 rounded-lg shadow-lg text-white ${"success"===s?"bg-green-600":"bg-red-600"} z-50`,children:e})}function c({text:e="Memuat..."}){return(0,t.jsx)("div",{className:"fixed inset-0 bg-white/80 z-[60] flex items-center justify-center",children:(0,t.jsxs)("div",{className:"flex flex-col items-center",children:[(0,t.jsx)("div",{className:"w-12 h-12 border-4 border-gray-200 border-t-blue-600 rounded-full animate-spin"}),(0,t.jsx)("p",{className:"mt-2 text-gray-700 font-semibold",children:e})]})})}function m(){let e=(0,l.useRouter)(),[m,u]=(0,a.useState)(null),[g,x]=(0,a.useState)(!0),[b,h]=(0,a.useState)(!1),[p,f]=(0,a.useState)(null),[y,j]=(0,a.useState)([]),[w,N]=(0,a.useState)(!1),[v,k]=(0,a.useState)(null),[S,A]=(0,a.useState)(""),[U,C]=(0,a.useState)(""),[D,T]=(0,a.useState)(""),[G,B]=(0,a.useState)("draft"),[$,P]=(0,a.useState)(null),[F,K]=(0,a.useState)(null),[M,E]=(0,a.useState)(null),R=(0,o.collection)(r.db,"blogPosts");(0,a.useEffect)(()=>{let t=(0,i.onAuthStateChanged)(r.auth,t=>{t?u(t.uid):e.push("/admin")}),a=()=>{};if(m){0!==y.length||w||x(!0);let e=(0,o.query)(R,(0,o.orderBy)("createdAt","desc"));a=(0,o.onSnapshot)(e,e=>{j(e.docs.map(e=>({id:e.id,...e.data()}))),x(!1)},e=>{console.error("Gagal mengambil data blog:",e),f({msg:"Gagal memuat artikel blog.",type:"error"}),x(!1)})}else x(!1);return()=>{t(),a()}},[e,m,w]);let z=e=>e.toString().toLowerCase().replace(/\s+/g,"-").replace(/[^\w\-]+/g,"").replace(/\-\-+/g,"-").replace(/^-+/,"").replace(/-+$/,""),I=()=>{k(null),A(""),C(""),T(""),B("draft"),P(null),K(null),E(null)},L=()=>{b||(I(),N(!1))},O=async e=>{if(e.preventDefault(),!m||!S||!D)return void f({msg:"Judul dan Konten Artikel wajib diisi.",type:"error"});if(!v&&!$)return void f({msg:"Gambar utama wajib diupload.",type:"error"});h(!0),f(null);try{let e=M||"";if($){if(M)try{let e=(0,d.ref)(r.storage,M);await (0,d.deleteObject)(e)}catch(e){"storage/object-not-found"!==e.code&&console.warn("Gagal hapus gambar lama, tapi lanjut:",e)}let t=`${m}_blog_${Date.now()}_${$.name}`,a=(0,d.ref)(r.storage,`blogImages/${t}`);console.log(`Uploading ke: blogImages/${t}`);let s=await (0,d.uploadBytes)(a,$);e=await (0,d.getDownloadURL)(s.ref),console.log("Upload gambar blog berhasil:",e)}else if(!v&&!e)throw Error("Gambar utama wajib ada untuk artikel baru.");let t={title:S,slug:U||z(S),content:D,imageUrl:e,status:G,updatedAt:(0,o.serverTimestamp)()};if(v){let e=(0,o.doc)(r.db,"blogPosts",v);await (0,o.updateDoc)(e,t),console.log("Artikel diupdate:",v)}else{let e=await (0,o.addDoc)(R,{...t,createdAt:(0,o.serverTimestamp)(),authorId:m});console.log("Artikel baru ditambahkan:",e.id)}f({msg:"Artikel berhasil disimpan!",type:"success"}),L()}catch(e){console.error("Gagal menyimpan artikel:",e),f({msg:`Gagal menyimpan: ${e.message||e.code}`,type:"error"})}finally{h(!1)}},q=async e=>{if(confirm(`Yakin ingin menghapus artikel "${e.title}"?`)){h(!0),f(null);try{if(await (0,o.deleteDoc)((0,o.doc)(r.db,"blogPosts",e.id)),console.log("Dokumen blog dihapus:",e.id),e.imageUrl)try{let t=(0,d.ref)(r.storage,e.imageUrl);await (0,d.deleteObject)(t),console.log("Gambar blog dihapus:",e.imageUrl)}catch(t){"storage/object-not-found"!==t.code?console.warn("Gagal hapus gambar, tapi dokumen terhapus:",t):console.log("Gambar sudah tidak ada di storage:",e.imageUrl)}f({msg:"Artikel berhasil dihapus.",type:"success"})}catch(e){console.error("Gagal menghapus artikel:",e),f({msg:`Gagal menghapus: ${e.message||e.code}`,type:"error"})}finally{h(!1)}}};return(0,t.jsxs)(t.Fragment,{children:[p&&(0,t.jsx)(n,{message:p.msg,type:p.type,onDone:()=>f(null)}),g&&(0,t.jsx)(c,{text:"Memuat artikel..."}),b&&(0,t.jsx)(c,{text:"Menyimpan/Menghapus..."}),(0,t.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,t.jsxs)("div",{className:"flex items-center gap-4",children:[(0,t.jsx)(s.default,{href:"/dashboard/cms",children:(0,t.jsxs)("span",{className:"text-gray-500 hover:text-blue-600 cursor-pointer",children:[(0,t.jsx)("i",{className:"fas fa-arrow-left mr-2"}),"Kembali ke Hpanel"]})}),(0,t.jsx)("h2",{className:"text-2xl font-bold text-gray-800",children:"Kelola Artikel/Blog"})]}),(0,t.jsxs)("button",{onClick:()=>{I(),N(!0)},className:"bg-blue-600 text-white font-semibold py-2 px-4 rounded-lg shadow-md hover:bg-blue-700 transition-all flex items-center gap-2",children:[(0,t.jsx)("i",{className:"fas fa-plus"})," Tulis Artikel Baru"]})]}),(0,t.jsxs)("div",{className:"bg-white rounded-xl shadow-lg border border-gray-200 overflow-hidden",children:[(0,t.jsxs)("h3",{className:"text-xl font-semibold text-gray-800 p-6 border-b border-gray-200",children:[(0,t.jsx)("i",{className:"fas fa-newspaper mr-2 text-orange-500"})," Daftar Artikel"]}),g?(0,t.jsx)("p",{className:"text-center py-10 text-gray-500",children:"Memuat..."}):y.length>0?(0,t.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,t.jsx)("thead",{className:"bg-gray-50",children:(0,t.jsxs)("tr",{children:[(0,t.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Judul"}),(0,t.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),(0,t.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Tanggal Dibuat"}),(0,t.jsx)("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Aksi"})]})}),(0,t.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:y.map(e=>(0,t.jsxs)("tr",{className:"hover:bg-gray-50",children:[(0,t.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,t.jsxs)("div",{className:"flex items-center",children:[(0,t.jsx)("div",{className:"flex-shrink-0 h-10 w-10",children:(0,t.jsx)("img",{className:"h-10 w-10 rounded-md object-cover bg-gray-200",src:e.imageUrl||"https://placehold.co/100x100/e2e8f0/94a3b8?text=N/A",alt:""})}),(0,t.jsxs)("div",{className:"ml-4",children:[(0,t.jsx)("div",{className:"text-sm font-medium text-gray-900",children:e.title}),(0,t.jsxs)("div",{className:"text-sm text-gray-500",children:["/",e.slug]})]})]})}),(0,t.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:"published"===e.status?(0,t.jsx)("span",{className:"px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-green-100 text-green-800",children:"Published"}):(0,t.jsx)("span",{className:"px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-yellow-100 text-yellow-800",children:"Draft"})}),(0,t.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:e.createdAt?.toDate?e.createdAt.toDate().toLocaleDateString("id-ID"):"-"}),(0,t.jsxs)("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium space-x-2",children:[(0,t.jsx)("button",{onClick:()=>{I(),k(e.id),A(e.title),C(e.slug),T(e.content),B(e.status||"draft"),K(e.imageUrl),E(e.imageUrl),N(!0)},className:"text-indigo-600 hover:text-indigo-900",title:"Edit",children:(0,t.jsx)("i",{className:"fas fa-edit"})}),(0,t.jsx)("button",{onClick:()=>q(e),className:"text-red-600 hover:text-red-900",title:"Hapus",children:(0,t.jsx)("i",{className:"fas fa-trash"})})]})]},e.id))})]}):(0,t.jsx)("p",{className:"text-center text-gray-500 py-10",children:'Belum ada artikel. Klik "Tulis Artikel Baru" untuk memulai.'})]}),w&&(0,t.jsxs)("div",{className:"fixed inset-0 bg-black/50 z-40 flex items-center justify-center p-4",children:[(0,t.jsx)("div",{onClick:L,className:"absolute inset-0"}),(0,t.jsxs)("div",{className:"relative bg-white rounded-2xl shadow-2xl w-full max-w-3xl max-h-[90vh] flex flex-col",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between p-5 border-b border-gray-200 sticky top-0 bg-white rounded-t-2xl z-10",children:[(0,t.jsx)("h2",{className:"text-xl font-bold text-gray-900",children:v?"Edit Artikel":"Tulis Artikel Baru"}),(0,t.jsx)("button",{onClick:L,className:"text-gray-400 hover:text-gray-600",children:(0,t.jsx)("i",{className:"fas fa-times fa-lg"})})]}),(0,t.jsxs)("form",{id:"blogForm",onSubmit:O,className:"flex-grow overflow-y-auto p-6 space-y-5",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{htmlFor:"postTitle",className:"block text-sm font-medium text-gray-700 mb-1",children:"Judul Artikel"}),(0,t.jsx)("input",{id:"postTitle",type:"text",value:S,onChange:e=>A(e.target.value),required:!0,className:"w-full p-3 border border-gray-300 rounded-lg shadow-sm focus:border-blue-500 focus:ring-blue-500"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{htmlFor:"postSlug",className:"block text-sm font-medium text-gray-700 mb-1",children:"Slug (URL)"}),(0,t.jsx)("input",{id:"postSlug",type:"text",value:U,onChange:e=>C(z(e.target.value)),className:"w-full p-3 border border-gray-300 rounded-lg shadow-sm focus:border-blue-500 focus:ring-blue-500 bg-gray-50",placeholder:"Kosongkan untuk auto-generate"}),(0,t.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:"Hanya huruf kecil, angka, dan tanda hubung (-)."})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{htmlFor:"postContent",className:"block text-sm font-medium text-gray-700 mb-1",children:"Konten Artikel"}),(0,t.jsx)("textarea",{id:"postContent",value:D,onChange:e=>T(e.target.value),rows:15,required:!0,className:"w-full p-3 border border-gray-300 rounded-lg shadow-sm focus:border-blue-500 focus:ring-blue-500",placeholder:"Tulis isi artikel Anda di sini..."})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Gambar Utama (Maks 2MB)"}),F?(0,t.jsx)("img",{src:F,alt:"Preview",className:"w-full max-w-sm h-auto aspect-video object-cover border border-gray-200 rounded-lg bg-gray-50 mb-2"}):(0,t.jsx)("div",{className:"w-full max-w-sm aspect-video flex items-center justify-center border border-dashed border-gray-300 rounded-lg bg-gray-50 text-gray-400 mb-2",children:"Image Preview"}),(0,t.jsx)("input",{id:"postImageFile",type:"file",accept:"image/png, image/jpeg, image/webp",onChange:e=>{let t=e.target.files?.[0];if(t){if(t.size>2097152)return void f({msg:"Ukuran gambar maksimal 2 MB.",type:"error"});P(t),K(URL.createObjectURL(t))}},className:"block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{htmlFor:"postStatus",className:"block text-sm font-medium text-gray-700 mb-1",children:"Status"}),(0,t.jsxs)("select",{id:"postStatus",value:G,onChange:e=>B(e.target.value),className:"w-full p-3 border border-gray-300 rounded-lg shadow-sm focus:border-blue-500 focus:ring-blue-500 bg-white",children:[(0,t.jsx)("option",{value:"draft",children:"Draft (Simpan)"}),(0,t.jsx)("option",{value:"published",children:"Published (Terbitkan)"})]})]})]}),(0,t.jsxs)("div",{className:"flex items-center justify-end p-5 border-t border-gray-200 sticky bottom-0 bg-gray-50 rounded-b-2xl z-10",children:[(0,t.jsx)("button",{onClick:L,type:"button",className:"bg-white text-gray-700 font-semibold py-2 px-4 rounded-lg border border-gray-300 mr-3 hover:bg-gray-50",children:"Batal"}),(0,t.jsxs)("button",{type:"submit",form:"blogForm",disabled:b,className:"bg-blue-600 text-white font-semibold py-2 px-4 rounded-lg shadow-md hover:bg-blue-700 transition-all disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2",children:[b?(0,t.jsx)("i",{className:"fas fa-spinner fa-spin"}):(0,t.jsx)("i",{className:"fas fa-save"}),v?"Update Artikel":"Simpan Artikel"]})]})]})]})]})}e.s(["default",()=>m])}]);